<mxfile host="app.diagrams.net" modified="2024-04-03T02:52:14.993Z" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" etag="295zwZakgMSIZ8lUK4Kb" version="24.2.1" type="github">
  <diagram name="第 1 页" id="wHKWAx3UkNSvwidnDVWt">
    <mxGraphModel dx="2868" dy="2809" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" background="none" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-148" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="2260" y="2140" width="1170" height="500" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-40" value="" style="rounded=0;whiteSpace=wrap;html=1;labelBorderColor=none;fillColor=#d5e8d4;strokeColor=#82b366;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="10" y="830" width="1340" height="500" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-1" value="RefCountedObject" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1410" y="-130" width="220" height="110" as="geometry">
            <mxRectangle x="410" y="480" width="140" height="30" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-2" value="- nref:&amp;nbsp; mutable std::atomic&amp;lt;uint64_t&amp;gt;&lt;div&gt;- cct:&amp;nbsp; &amp;nbsp; CephContext *&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-1">
          <mxGeometry y="26" width="220" height="34" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-3" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-1">
          <mxGeometry y="60" width="220" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-4" value="+ put():&amp;nbsp; &amp;nbsp;void&lt;div&gt;+ get():&amp;nbsp; &amp;nbsp;RefCountedObject *&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-1">
          <mxGeometry y="68" width="220" height="42" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-5" value="Message" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="398" y="291" width="490" height="430" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-6" value="# header:&amp;nbsp; ceph_msg_header&amp;nbsp; // 消息头：定义消息传递相关的 元数据&lt;div&gt;# footer:&amp;nbsp; &amp;nbsp; ceph_msg_footer&amp;nbsp; &amp;nbsp; // 消息尾：附加 crc 检验信息 和 结束标志&lt;/div&gt;&lt;div&gt;# payload: bufferlist&amp;nbsp; // 一般保存 ceph 操作相关的（没有对齐）&lt;/div&gt;&lt;div&gt;# middle:&amp;nbsp; &amp;nbsp;bufferlist&amp;nbsp; // 目前未使用到（没有对齐）&lt;/div&gt;&lt;div&gt;# data:&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;bufferlist&amp;nbsp; // 一般为读写的数据（尽可能的页对齐）&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;【一般情况下：&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;recv_stamp &amp;lt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;throttle_stamp &amp;lt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;recv_complete_stamp &amp;lt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;dispatch_stamp&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;// 消息开始接收的时间（使用当前时间设置该值后开始读取数据）&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;# recv_stamp:&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; utime_t&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;// 消息分发的时间（在具体分发函数开头使用当前值设置）&lt;/div&gt;&lt;div&gt;# dispatch_stamp:&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;utime_t&lt;/div&gt;&lt;div&gt;// 获取到 资源槽位的时间&lt;/div&gt;&lt;div&gt;# throttle_stamp:&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;utime_t&lt;/div&gt;&lt;div&gt;// 消息接收完成时间（接收完成后使用当前值设置）&lt;/div&gt;&lt;div&gt;# recv_complete_stamp: utime_t&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#ff0000&quot;&gt;# connection: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;ConnectionRef&amp;nbsp; // 网络连接句柄&lt;/font&gt;&lt;/div&gt;&lt;div&gt;#&amp;nbsp;trace:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;ZTracer::Trace&amp;nbsp; //&amp;nbsp;Zipkin追踪对象，记录请求在Ceph系统内部各个组件之间的传递和处理情况&lt;/div&gt;&lt;div&gt;# magic: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;uint32_t = 0&amp;nbsp; // 消息的 magic num&lt;br&gt;#&amp;nbsp;byte_throttler:&amp;nbsp;&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;Throttle * = nullptr&amp;nbsp; // 当 三个 bufferlist 释放后，资源大小释放给这个 节流器&lt;/div&gt;&lt;div&gt;#&amp;nbsp;msg_throttler:&amp;nbsp;&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Throttle * = nullptr&amp;nbsp; // 当前消息销毁时，释放一个资源（槽位）给此节流器&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;记录在预留空间时消息的大小，以便稍后能够正确释放空间&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;#&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;dispatch_throttle_size: uint64 = 0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;#&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;completion_hook:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;CompletionHook* = nullptr&amp;nbsp; // 消息销毁时（完成后）的回调&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-5">
          <mxGeometry y="26" width="490" height="404" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-11" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-5">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="613" y="340" as="sourcePoint" />
            <mxPoint x="1530" y="-20" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-14" value="ceph_msg_header" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="10" y="150" width="370" height="250" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-16" value="&lt;div&gt;+ seq : &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;__le64&amp;nbsp; // 当前 Session 内的唯一序号&lt;/div&gt;&lt;div&gt;+ tid : &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;__le64&amp;nbsp; // 消息的全局唯一 id&lt;/div&gt;&lt;div&gt;+ type : &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;__le16&amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;// 消息类型（OSD 心跳，MOSDOp 等)&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;+ priority :&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;__le16&amp;nbsp; // 消息的优先级&lt;/div&gt;&lt;div&gt;+ version : &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;__le16&amp;nbsp; // 消息编码的版本&lt;/div&gt;&lt;div&gt;+ front_len : &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;__le32&amp;nbsp; // payload 的长度&lt;/div&gt;&lt;div&gt;+ middle_len : &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;__le32&amp;nbsp; // middle 的长度&lt;/div&gt;&lt;div&gt;+ data_len : &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;__le32&amp;nbsp; // data 的长度&lt;/div&gt;&lt;div&gt;+ data_off :&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;__le16&amp;nbsp; // 对象的数据偏移量&lt;/div&gt;&lt;div&gt;+ src : &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;struct ceph_entity_name // 消息源，eg：osd0，mon3&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;// 一些旧代码用于兼容，如果为 0 请忽略&lt;/div&gt;&lt;div&gt;+ compat_version : __le16&lt;/div&gt;&lt;div&gt;+ reserved : &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;__le16&lt;/div&gt;&lt;div&gt;+ crc : &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;__le32&amp;nbsp; // 消息头的 crc 检验信息&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-14">
          <mxGeometry y="26" width="370" height="224" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-18" value="ceph_msg_footer" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="10" y="420" width="370" height="110" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-19" value="&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;front_crc&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;: &lt;/span&gt;&lt;span style=&quot;background-color: initial; white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;background-color: initial; white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;__le32&amp;nbsp; // payload 的 crc 信息&lt;/span&gt;&lt;/div&gt;&lt;div&gt;+ middle_crc&amp;nbsp;: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;__le32&amp;nbsp; // middle 的 crc 信息&lt;/div&gt;&lt;div&gt;+ data_crc : &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;__le32&amp;nbsp; // data 的 crc 信息&lt;/div&gt;&lt;div&gt;+ sig :&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;__le64&amp;nbsp; // 消息的 64 位签名信息&lt;/div&gt;&lt;div&gt;+ flags : &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;__u8&amp;nbsp;// 结束标志&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-18">
          <mxGeometry y="26" width="370" height="84" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-20" value="MOSDMap" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="870" width="160" height="86" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-21" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-20">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-22" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-20">
          <mxGeometry y="52" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-23" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-20">
          <mxGeometry y="60" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-24" value="MOSDPing" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="300" y="870" width="160" height="86" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-25" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-24">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-26" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-24">
          <mxGeometry y="52" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-27" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-24">
          <mxGeometry y="60" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-28" value="MOSDFastDispatchOp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="530" y="870" width="160" height="86" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-29" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-28">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-30" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-28">
          <mxGeometry y="52" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-31" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-28">
          <mxGeometry y="60" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-32" value="MOSDOpReply" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="740" y="870" width="160" height="86" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-33" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-32">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-34" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-32">
          <mxGeometry y="52" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-35" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-32">
          <mxGeometry y="60" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-36" value="MOSDOp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="374" y="1020" width="480" height="280" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-37" value="&lt;div&gt;-&amp;nbsp;HEAD_VERSION: static const int = 0&amp;nbsp; // 表示当前 消息的版本&lt;/div&gt;&lt;div&gt;-&amp;nbsp;COMPAT_VERSION:&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;static const int = 0&amp;nbsp; // 最低兼容以前消息的版本号&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;- client_inc:&amp;nbsp;uint32_t = 0&amp;nbsp; //&amp;nbsp;客户端递增计数器，用于跟踪来自同一客户端的请求顺序&lt;div&gt;-&amp;nbsp;osdmap_epoch:&amp;nbsp;__u32 = 0&amp;nbsp; // 该操作基于哪个 epoch 的 OSDMap&lt;/div&gt;&lt;div&gt;- flags:&amp;nbsp;__u32 = 0&amp;nbsp; //&amp;nbsp;用于标识操作的不同属性和行为&lt;/div&gt;&lt;div&gt;-&amp;nbsp;mtime:&amp;nbsp;utime_t&amp;nbsp; // 消息的创建修改时间（librados 中是使用 op 的 mtime 直接赋值）&lt;/div&gt;&lt;div&gt;-&amp;nbsp;retry_attempt: int32_t = -1&amp;nbsp; //&amp;nbsp;重试次数，0 表示第一次尝试&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&amp;nbsp;hobj:&amp;nbsp;hobject_t&amp;nbsp; //&amp;nbsp;操作的对象&lt;/div&gt;&lt;div&gt;-&amp;nbsp;pgid:&amp;nbsp;spg_t&amp;nbsp; //&amp;nbsp;对象所在的 PG&lt;/div&gt;&lt;div&gt;+&amp;nbsp;ops:&amp;nbsp;vector&amp;lt;OSDOp&amp;gt;&amp;nbsp; //&amp;nbsp;针对 hobj 多个操作的集合&lt;/div&gt;&lt;div&gt;-&amp;nbsp;reqid:&amp;nbsp;osd_reqid_t&amp;nbsp; // 由发送方确定的 唯一请求 id&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&amp;nbsp;snap_seq:&amp;nbsp;snapid_t&amp;nbsp; //&amp;nbsp;head 对象，就是最新的快照序号&lt;/div&gt;&lt;div&gt;-&amp;nbsp;snaps:&amp;nbsp;vector&amp;lt;snapid_t&amp;gt;&amp;nbsp; //&amp;nbsp;所有的 snap 列表&lt;/div&gt;&lt;div&gt;-&amp;nbsp;features:&amp;nbsp;uint64_t // 一组标志&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-36">
          <mxGeometry y="26" width="480" height="254" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-41" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.488;entryY=1.003;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-20" target="QgA-dz_zXuOLvlTgo4UR-6">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="320" y="860" as="sourcePoint" />
            <mxPoint x="480" y="860" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-42" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.503;entryY=1.003;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-24" target="QgA-dz_zXuOLvlTgo4UR-6">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="170" y="880" as="sourcePoint" />
            <mxPoint x="652" y="733" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-43" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-28">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="390" y="880" as="sourcePoint" />
            <mxPoint x="630" y="720" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-44" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-32">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="780" y="840" as="sourcePoint" />
            <mxPoint x="630" y="720" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-45" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.528;entryY=1.058;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-36" target="QgA-dz_zXuOLvlTgo4UR-31">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="620" y="880" as="sourcePoint" />
            <mxPoint x="640" y="730" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-47" value="&lt;font style=&quot;font-size: 17px;&quot;&gt;src/messages&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1250" y="840" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-48" value="Connection" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2160" y="291" width="400" height="274" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-49" value="- lock: mutable Mutex&amp;nbsp; // 互斥锁，保护临界资源&amp;nbsp;&lt;div&gt;-&amp;nbsp;priv:&amp;nbsp;RefCountedPtr&amp;nbsp; // boost::intrusive_ptr&amp;lt;RefCountedObject&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;- msgr: Messager *&amp;nbsp; &amp;nbsp; &amp;nbsp;// 网络模块对外接口的 抽象基类&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;- peer_type: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp;int&amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; // 连接的 peer 类型&lt;/div&gt;&lt;div&gt;- peer_addr: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&amp;nbsp;&lt;/span&gt;&amp;nbsp; entity_addr_t&amp;nbsp; // peer 的地址&lt;/div&gt;&lt;div&gt;-&amp;nbsp;last_keepalive: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp;utime_t&amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; // 最后一次发送 keeplive 的时间&lt;/div&gt;&lt;div&gt;-&amp;nbsp;last_keepalive_ack: utime_t&amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 最后一次接收 keeplive ack 的时间&lt;/div&gt;&lt;div&gt;-&amp;nbsp;features: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp;uint64_t&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 一些 feature 的标志位&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+ failed: bool&amp;nbsp; // 为true，代表该连接为 lossy，已经失效&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;rx_buffers_version: int&amp;nbsp; // 接收缓冲区的版本&lt;/div&gt;&lt;div&gt;// 【&lt;span style=&quot;background-color: initial;&quot;&gt;构成 Message 标识 ceph_tid -&amp;gt; (buffer,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial; border-color: var(--border-color);&quot;&gt;rx_buffers_version&lt;/span&gt;&lt;span style=&quot;background-color: initial; border-color: var(--border-color);&quot;&gt;)的映射】&lt;/span&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;rx_buffers:&amp;nbsp;map&amp;lt;ceph_tid_t, pair&amp;lt;bufferlist,int&amp;gt;&amp;gt;&amp;nbsp; // 接收缓冲区&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-48">
          <mxGeometry y="26" width="400" height="214" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-50" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-48">
          <mxGeometry y="240" width="400" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-51" value="+ send_message(Message *m) virtual int = 0;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-48">
          <mxGeometry y="248" width="400" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-52" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;entryX=0.522;entryY=1.031;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" target="QgA-dz_zXuOLvlTgo4UR-4">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2370" y="290" as="sourcePoint" />
            <mxPoint x="1609" y="-190" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-53" value="entity_addr_t" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1770" y="291" width="340" height="170" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-54" value="&lt;div&gt;//&amp;nbsp;网络地址的类型，不是 IPV4/IPV6之分，而是内部枚举不同ceph 版本的类型&lt;br&gt;&lt;/div&gt;&lt;div&gt;+ type: __u32&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;//&amp;nbsp;随机值或序列号，通常用于区分相同地址的不同实体，或者在网络通信中用于安全目的&lt;/span&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;nonce: __u32&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;// peer 端地址&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;u: union {&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;sockaddr sa;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;sockaddr_in sin;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;sockaddr_in6 sin6;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-53">
          <mxGeometry y="26" width="340" height="144" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-55" value="" style="rounded=0;whiteSpace=wrap;html=1;labelBorderColor=none;fillColor=#d5e8d4;strokeColor=#82b366;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="1700" y="830" width="1340" height="500" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-57" value="PipeConnection" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1810" y="900" width="190" height="86" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-58" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-57">
          <mxGeometry y="26" width="190" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-59" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-57">
          <mxGeometry y="52" width="190" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-60" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-57">
          <mxGeometry y="60" width="190" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-61" value="AsyncConnection" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2207" y="900" width="300" height="230" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-62" value="- async_msgr:&amp;nbsp;&amp;nbsp;AsyncMessenger *&lt;div&gt;-&amp;nbsp;conn_id:&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; uint64_t&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;policy:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Messenger::Policy&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;read_handler:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;EventCallbackRef&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;write_handler:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;EventCallbackRef&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;wakeup_handler:&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;EventCallbackRef&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;tick_handler:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;EventCallbackRef&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;// many others&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-61">
          <mxGeometry y="26" width="300" height="154" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-63" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-61">
          <mxGeometry y="180" width="300" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-64" value="&lt;div&gt;// 直接发送了，其余的是调用对应 messenger 的 send&lt;br&gt;&lt;/div&gt;&lt;div&gt;+ AsyncConnection::send_message(Message *m):&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;int&amp;nbsp;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-61">
          <mxGeometry y="188" width="300" height="42" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-65" value="XioConnection" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2790" y="900" width="190" height="86" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-66" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-65">
          <mxGeometry y="26" width="190" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-67" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-65">
          <mxGeometry y="52" width="190" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-68" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-65">
          <mxGeometry y="60" width="190" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-69" value="" style="endArrow=open;endFill=1;endSize=12;html=1;rounded=0;exitX=1.002;exitY=0.46;exitDx=0;exitDy=0;exitPerimeter=0;entryX=-0.01;entryY=0.855;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-6" target="QgA-dz_zXuOLvlTgo4UR-49">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="1270" y="500" as="sourcePoint" />
            <mxPoint x="1430" y="500" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-92" value="Component" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="QgA-dz_zXuOLvlTgo4UR-69">
          <mxGeometry x="-0.008" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-70" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.493;entryY=1.005;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-57" target="QgA-dz_zXuOLvlTgo4UR-51">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2500" y="450" as="sourcePoint" />
            <mxPoint x="2660" y="450" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-71" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.492;entryY=1.003;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-61" target="QgA-dz_zXuOLvlTgo4UR-51">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="1915" y="910" as="sourcePoint" />
            <mxPoint x="2360" y="570" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-72" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.488;entryY=0.969;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-65" target="QgA-dz_zXuOLvlTgo4UR-51">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2405" y="910" as="sourcePoint" />
            <mxPoint x="2360" y="570" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-74" value="Dispatcher" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="462" y="1888" width="270" height="100" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-75" value="# cct:&amp;nbsp; CephContext" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-74">
          <mxGeometry y="26" width="270" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-76" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-74">
          <mxGeometry y="52" width="270" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-77" value="+ ms_fast_dispatch(Message *m):&amp;nbsp;virtual void;&lt;div&gt;+ ms_dispatch(Message *m):&amp;nbsp;virtual bool = 0&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-74">
          <mxGeometry y="60" width="270" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-78" value="Messenger" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1770" y="1800" width="580" height="278" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-79" value="&lt;div&gt;-&amp;nbsp;dispatchers:&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&amp;nbsp;&lt;/span&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp; list&amp;lt;Dispatcher*&amp;gt;&amp;nbsp; // Messenger 持有的所有 分发器&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;fast_dispatchers:&amp;nbsp;list&amp;lt;Dispatcher*&amp;gt;&amp;nbsp; // 支持快速分发的分发器集合&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;trace_endpoint:&amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;ZTracer::Endpoint&amp;nbsp; //&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;PingFang SC&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;分布式追踪的端点&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;PingFang SC&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;PingFang SC&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;PingFang SC&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;定义在 src/msg/msg_type.h 中，包括对 MON, MGR, OSD, MDS, CLIENT 的类型定义&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; font-family: &amp;quot;PingFang SC&amp;quot;; font-size: 13px;&quot;&gt;# my_inst:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;PingFang SC&quot;&gt;entity_inst_t&amp;nbsp; //&amp;nbsp;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-family: &amp;quot;PingFang SC&amp;quot;; font-size: 13px;&quot;&gt;表示本地守护进程的实例，例如 client.99(包含名称和地址)&amp;nbsp;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;PingFang SC&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;#&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;PingFang SC&quot;&gt;default_send_priority： 消息默认发送的优先级（可以影响发送顺序）&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;PingFang SC&quot;&gt;#&amp;nbsp;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;PingFang SC&quot;&gt;started: bool&amp;nbsp; // 标识当前 Messenger 是否启动（某些配置需在关闭状态下设置）&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;PingFang SC&quot;&gt;# magic: uint32_t&amp;nbsp; // magic num，标识和验证 Messenger&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;PingFang SC&quot;&gt;#&amp;nbsp;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;PingFang SC&quot;&gt;socket_priority: int&amp;nbsp; // 套接字优先级&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;PingFang SC&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;PingFang SC&quot;&gt;+ cct: CephContext&amp;nbsp; // 当前 Messgenger 的 ceph 上下文，许多其它组件会使用此值初始化自己&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;PingFang SC&quot;&gt;+ crcflags: int&amp;nbsp; // 控制 Message 的 crc 检验&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=#6c8ebf;fillColor=#dae8fc;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-78">
          <mxGeometry y="26" width="580" height="204" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-80" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-78">
          <mxGeometry y="230" width="580" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-81" value="+ ms_fast_dispatch(Message *m):&amp;nbsp;virtual void;&lt;div&gt;+ ms_dispatch(Message *m):&amp;nbsp;virtual bool = 0&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=#6c8ebf;fillColor=#dae8fc;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-78">
          <mxGeometry y="238" width="580" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-82" value="SimplePolicyMessenger" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1900" y="2180" width="350" height="80" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-83" value="- policy_lock:&amp;nbsp;Mutex&lt;div&gt;-&amp;nbsp;default_policy:&amp;nbsp;Policy&amp;nbsp; // 给 Pipe 的默认策略&lt;/div&gt;&lt;div&gt;-&amp;nbsp;policy_map:&amp;nbsp;map&amp;lt;int, Policy&amp;gt;&amp;nbsp; //&amp;nbsp;entity_name_t::type -&amp;gt; Policy&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-82">
          <mxGeometry y="26" width="350" height="54" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-86" value="Policy" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2540" y="1816" width="360" height="200" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-87" value="+&amp;nbsp;lossy: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;bool&amp;nbsp; // 如果为 true，该连接出现错误就删除&lt;div&gt;+ server: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;bool&amp;nbsp; // 为 true 代表是服务端，只有被动连接&lt;/div&gt;&lt;div&gt;+ standby: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;bool&amp;nbsp; // 如果为 true 空闲时该连接处于等待状态&lt;/div&gt;&lt;div&gt;+ resetcheck: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;bool&amp;nbsp; // 为true出现错误后重连&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;// 该 Connection 的流控策略&lt;/div&gt;&lt;div&gt;+&amp;nbsp;throttler_bytes:&amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp;Throttle *&lt;/div&gt;&lt;div&gt;+&amp;nbsp;throttler_messages:&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;Throttle *&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;features_supported:&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;uint64_t&amp;nbsp; // 本地端的一些 feature 标志&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;features_required:&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;uint64_t&amp;nbsp; // 对端的一些 feature 标志&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-86">
          <mxGeometry y="26" width="360" height="174" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-90" value="" style="endArrow=open;startArrow=circlePlus;endFill=0;startFill=0;endSize=8;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-79" target="QgA-dz_zXuOLvlTgo4UR-87">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2300" y="1920" as="sourcePoint" />
            <mxPoint x="2460" y="1920" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-91" value="inner class" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="QgA-dz_zXuOLvlTgo4UR-90">
          <mxGeometry x="-0.2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-97" value="SimpleMessenger" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1650" y="2320" width="160" height="86" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-98" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-97">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-99" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-97">
          <mxGeometry y="52" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-100" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-97">
          <mxGeometry y="60" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-101" value="AsyncMessenger" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2270" y="2320" width="380" height="170" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-102" value="- deleted_conns:&amp;nbsp;set&amp;lt;AsyncConnectionRef&amp;gt;&lt;div&gt;-&amp;nbsp;accepting_conns:&amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;set&amp;lt;AsyncConnectionRef&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;conns:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;ceph::unordered_map&amp;lt;entity_addr_t, AsyncConnectionRef&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;dispatch_queue:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;DispatchQueue&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-101">
          <mxGeometry y="26" width="380" height="74" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-103" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-101">
          <mxGeometry y="100" width="380" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-104" value="&lt;div&gt;// 处理后调用 con-&amp;gt;submit_message()&lt;/div&gt;+&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;submit_message(Message *m, AsyncConnectionRef con,&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; const entity_addr_t&amp;amp; dest_addr, int dest_type)&lt;/span&gt;:&amp;nbsp;void" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-101">
          <mxGeometry y="108" width="380" height="62" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-105" value="XioMessenger" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1995" y="2320" width="160" height="86" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-106" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-105">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-107" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-105">
          <mxGeometry y="52" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-108" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-105">
          <mxGeometry y="60" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-109" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;entryX=0.501;entryY=1.028;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" target="QgA-dz_zXuOLvlTgo4UR-83">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="1734" y="2320" as="sourcePoint" />
            <mxPoint x="2070" y="2390" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-110" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.504;entryY=1.043;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-101" target="QgA-dz_zXuOLvlTgo4UR-83">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="1744" y="2330" as="sourcePoint" />
            <mxPoint x="2085" y="2272" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-111" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.499;entryY=1.028;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-105" target="QgA-dz_zXuOLvlTgo4UR-83">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2070" y="2330" as="sourcePoint" />
            <mxPoint x="2086" y="2272" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-112" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.526;entryY=1.042;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-82" target="QgA-dz_zXuOLvlTgo4UR-81">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2080" y="2340" as="sourcePoint" />
            <mxPoint x="2070" y="2110" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-113" value="librados::RadosClient" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="132" y="2080" width="160" height="86" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-114" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-113">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-115" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-113">
          <mxGeometry y="52" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-116" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-113">
          <mxGeometry y="60" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-117" value="Client" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="379" y="2080" width="160" height="86" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-118" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-117">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-119" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-117">
          <mxGeometry y="52" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-120" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-117">
          <mxGeometry y="60" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-121" value="OSD" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="842" y="2080" width="160" height="86" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-122" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-121">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-123" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-121">
          <mxGeometry y="52" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-124" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-121">
          <mxGeometry y="60" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-125" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.509;entryY=1.05;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-113" target="QgA-dz_zXuOLvlTgo4UR-77">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="642" y="2338" as="sourcePoint" />
            <mxPoint x="642" y="2238" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-126" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-117">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="222" y="2090" as="sourcePoint" />
            <mxPoint x="592" y="1988" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-127" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-121">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="922" y="2078" as="sourcePoint" />
            <mxPoint x="592" y="1988" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-134" value="Relation" style="endArrow=open;html=1;endSize=12;startArrow=diamondThin;startSize=14;startFill=0;edgeStyle=orthogonalEdgeStyle;rounded=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-79" target="QgA-dz_zXuOLvlTgo4UR-75">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1210" y="2030" as="sourcePoint" />
            <mxPoint x="1370" y="2030" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-135" value="1" style="edgeLabel;resizable=0;html=1;align=left;verticalAlign=top;" connectable="0" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-134">
          <mxGeometry x="-1" relative="1" as="geometry">
            <mxPoint x="-30" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-136" value="0...n" style="edgeLabel;resizable=0;html=1;align=right;verticalAlign=top;" connectable="0" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-134">
          <mxGeometry x="1" relative="1" as="geometry">
            <mxPoint x="38" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-137" value="Objecter" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="610" y="2080" width="160" height="86" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-138" value="+ messenger:&amp;nbsp;Messenger *" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-137">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-139" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-137">
          <mxGeometry y="52" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-140" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-137">
          <mxGeometry y="60" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-141" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-137">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="469" y="2090" as="sourcePoint" />
            <mxPoint x="590" y="1990" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-142" value="1" style="endArrow=open;html=1;endSize=12;startArrow=diamondThin;startSize=14;startFill=0;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=bottom;rounded=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-49" target="QgA-dz_zXuOLvlTgo4UR-78">
          <mxGeometry x="-1" y="3" relative="1" as="geometry">
            <mxPoint x="2110" y="1580" as="sourcePoint" />
            <mxPoint x="2270" y="1580" as="targetPoint" />
            <Array as="points">
              <mxPoint x="3130" y="424" />
              <mxPoint x="3130" y="1410" />
              <mxPoint x="2060" y="1410" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-143" value="DispatchQueue" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2830" y="2205" width="540" height="400" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-144" value="- cct:&amp;nbsp;CephContext *&lt;div&gt;-&amp;nbsp;msgr:&amp;nbsp;Messenger *&amp;nbsp; &amp;nbsp; //&amp;nbsp;指向消息传递接口的指针，用于消息的发送和接收&lt;/div&gt;&lt;div&gt;-&amp;nbsp;lock: mutable Mutex&lt;/div&gt;&lt;div&gt;- cond: Cond&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;//&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;QueueItem 封装了下面枚举的 code 以及 待分发的 Message，可使用 get_code 区分判断&lt;/span&gt;&lt;/div&gt;&lt;div&gt;-&amp;nbsp;mqueue:&amp;nbsp;PrioritizedQueue&amp;lt;QueueItem, uint64_t&amp;gt; // k:&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;QueueItem, v: 优先级&lt;/span&gt;&lt;/div&gt;&lt;div&gt;-&amp;nbsp;marrival:&amp;nbsp;set&amp;lt;pair&amp;lt;double, Message*&amp;gt;&amp;gt;&amp;nbsp; // 记录消息到达时间, 使用 m-&amp;gt;get_recv_stamp() 作为 key&lt;/div&gt;&lt;div&gt;-&amp;nbsp;marrival_map:&amp;nbsp;map&amp;lt;Message *, set&amp;lt;pair&amp;lt;double, Message*&amp;gt;&amp;gt;::iterator&amp;gt;&amp;nbsp; //&amp;nbsp;一个映射，用于快速查找 marrival 中的元素&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&amp;nbsp;next_id:&amp;nbsp;std::atomic&amp;lt;uint64_t&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; // 用于生成唯一的消息 ID&lt;/div&gt;&lt;div&gt;-&amp;nbsp;enum { D_CONNECT = 1, D_ACCEPT, D_BAD_REMOTE_RESET, D_BAD_RESET, D_CONN_REFUSED, D_NUM_CODES };&amp;nbsp; //&amp;nbsp;枚举类型，定义了内部事件代码&lt;/div&gt;&lt;div&gt;-&amp;nbsp;dispatch_thread:&amp;nbsp;DispatchThread&amp;nbsp; // 消息分发线程&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&amp;nbsp;local_delivery_lock:&amp;nbsp;Mutex&lt;/div&gt;&lt;div&gt;-&amp;nbsp;local_delivery_cond:&amp;nbsp;Cond&lt;/div&gt;&lt;div&gt;-&amp;nbsp;stop_local_delivery:&amp;nbsp;bool&lt;/div&gt;&lt;div&gt;-&amp;nbsp;local_messages:&amp;nbsp;list&amp;lt;pair&amp;lt;Message *, int&amp;gt;&amp;gt;&amp;nbsp; //&amp;nbsp;本地消息列表，用于存储待传递的消息&lt;/div&gt;&lt;div&gt;-&amp;nbsp;local_delivery_thread:&amp;nbsp;LocalDeliveryThread&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;dispatch_throttler:&amp;nbsp;Throttle&amp;nbsp; //&amp;nbsp;控制消息分发速率的节流器&lt;/div&gt;&lt;div&gt;+&amp;nbsp;stop: bool&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-143">
          <mxGeometry y="26" width="540" height="324" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-145" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-143">
          <mxGeometry y="350" width="540" height="8" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-146" value="+ DispatchQueue::entry(): void&lt;div&gt;+&amp;nbsp;DispatchQueue::enqueue(Message *m, int priority, uint64_t id): void&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" vertex="1" parent="QgA-dz_zXuOLvlTgo4UR-143">
          <mxGeometry y="358" width="540" height="42" as="geometry" />
        </mxCell>
        <mxCell id="QgA-dz_zXuOLvlTgo4UR-147" value="Use" style="endArrow=open;endSize=12;dashed=1;html=1;rounded=0;exitX=0.994;exitY=0.631;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="QgA-dz_zXuOLvlTgo4UR-102" target="QgA-dz_zXuOLvlTgo4UR-144">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2590" y="2370" as="sourcePoint" />
            <mxPoint x="2750" y="2370" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
