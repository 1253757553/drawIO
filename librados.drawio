<mxfile host="app.diagrams.net" modified="2024-04-10T09:25:15.377Z" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" etag="x8KdOBgPZZihuTZc01Yl" version="24.2.3" type="github">
  <diagram id="C5RBs43oDa-KdzZeNtuy" name="Page-1">
    <mxGraphModel dx="3703" dy="2340" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-1" parent="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="vteJUobceDA6RaGQ8-ky-138" value="" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;arcSize=42;fontFamily=Helvetica;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-1070" y="3320" width="3870" height="1280" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-73" value="" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;arcSize=42;fontFamily=Helvetica;fontSize=12;fillColor=#d5e8d4;strokeColor=#82b366;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-1070" y="-730" width="3870" height="2600" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-16" value="" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;arcSize=42;fontFamily=Helvetica;fontSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="360" y="-1120" width="740" height="290" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-0" value="ObjectOperation" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="785" y="1560" width="430" height="250" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-1" value="+ ops:&amp;nbsp;vector&amp;lt;OSDOp&amp;gt;&amp;nbsp; // 多个 OSD 操作的集合&lt;div&gt;+&amp;nbsp;flags: int&lt;/div&gt;&lt;div&gt;+&amp;nbsp;priority: int&amp;nbsp; // 操作的优先级，OSD 端有优先级队列&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;out_bl:&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;vector&amp;lt;bufferlist*&amp;gt; // 每个操作的输出集合&lt;/div&gt;&lt;div&gt;+&amp;nbsp;out_handler:&amp;nbsp;vector&amp;lt;Context*&amp;gt; // 每个操作的回调&lt;/div&gt;&lt;div&gt;+&amp;nbsp;out_rval:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;vector&amp;lt;int*&amp;gt;&amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&amp;nbsp;&lt;/span&gt;&amp;nbsp; &amp;nbsp; // 每个操作的返回值&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="vteJUobceDA6RaGQ8-ky-0" vertex="1">
          <mxGeometry y="26" width="430" height="124" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-2" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="vteJUobceDA6RaGQ8-ky-0" vertex="1">
          <mxGeometry y="150" width="430" height="10" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-3" value="+ add_data(int op, uint64_t off, uint64_t len, bufferlist&amp;amp; bl): void&lt;div&gt;+&amp;nbsp;add_xattr(int op, const char *name, const bufferlist&amp;amp; data): void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;add_call(int op, const char *cname, const char *method,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;bufferlist &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;amp;indata,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;bufferlist *outbl, Context *ctx, int *prval): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;.......&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="vteJUobceDA6RaGQ8-ky-0" vertex="1">
          <mxGeometry y="160" width="430" height="90" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-4" value="OSDOp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="810" y="-1040" width="250" height="190" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-5" value="+ op:&amp;nbsp;ceph_osd_op&lt;div&gt;+ soid: sobject_t&amp;nbsp; // src obj 操作的对象，对于&amp;nbsp;rados_clone_range 就是 src obj&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;indata:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;bufferlist&amp;nbsp; // 操作的输入，比如写对象的数据，或者 cls 的输入&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+ outdata:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;bufferlist&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; // 输出，读取读操作的输出或者 cls 的输出&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;rval:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;errorcode32_t&amp;nbsp; // 操作的 code 返回值&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="vteJUobceDA6RaGQ8-ky-4" vertex="1">
          <mxGeometry y="26" width="250" height="164" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-8" value="ceph_osd_op" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="510" y="-1040" width="250" height="110" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-9" value="+&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;op:&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;__le16&amp;nbsp; //&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;CEPH_OSD_OP_*&amp;nbsp;&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+ flags:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;__le32&amp;nbsp; //&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;CEPH_OSD_OP_FLAG_*&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+ union: 内部是对 data/xattr/cls/pg 等不同操作所需信息的 struct&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;payload_len:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;__le32&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="vteJUobceDA6RaGQ8-ky-8" vertex="1">
          <mxGeometry y="26" width="250" height="84" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-14" value="&lt;span style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;对单个对象的操作。每个可能都伴随着一些数据有效负载&lt;/font&gt;&lt;/span&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;ul style=&quot;border-color: var(--border-color); padding-left: 20px; margin-top: 2px; margin-left: 0px; margin-bottom: 2px; font-size: 10px;&quot;&gt;&lt;li style=&quot;border-color: var(--border-color); font-size: 10px;&quot;&gt;&lt;span style=&quot;border-color: var(--border-color); text-wrap: wrap; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;CEPH_OSD_OP_*：标识该 op 的具体操作，读/写/其它&lt;/font&gt;&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;border-color: var(--border-color); font-size: 10px;&quot;&gt;&lt;span style=&quot;border-color: var(--border-color); text-wrap: wrap; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;CEPH_OSD_OP_FLAG_*：给操作提供额外信息，比如是排他写还是覆盖写&lt;/font&gt;&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;fontFamily=Helvetica;fontSize=10;fillColor=#e1d5e7;strokeColor=#9673a6;imageWidth=24;arcSize=12;absoluteArcSize=0;imageHeight=24;imageAspect=1;imageAlign=left;imageVerticalAlign=middle;fillOpacity=100;overflow=width;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="380" y="-1105" width="380" height="50" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-17" value="osd_types.h 定义了 OSDOp 格式" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="900" y="-1120" width="200" height="30" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-21" value="ops、&lt;span style=&quot;text-wrap: wrap; font-size: 10px;&quot;&gt;out_bl&lt;/span&gt;、&lt;span style=&quot;text-wrap: wrap; font-size: 10px;&quot;&gt;out_handler&lt;/span&gt;、&lt;span style=&quot;text-wrap: wrap; font-size: 10px;&quot;&gt;out_rval 的&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-wrap: wrap; font-size: 10px;&quot;&gt;size 相同，对应元素不存在&lt;/span&gt;&lt;span style=&quot;text-wrap: wrap; font-size: 10px;&quot;&gt;则指向 NULL&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#82b366;fillColor=#d5e8d4;fontFamily=Helvetica;fontSize=10;portConstraint=east;overflow=width;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="810" y="1520" width="380" height="30" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-22" value="Objecter : public&amp;nbsp;&lt;b style=&quot;border-color: var(--border-color);&quot;&gt;Dispatcher&lt;/b&gt;" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="380" y="-660" width="680" height="1360" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-23" value="+ messenger:&amp;nbsp;Messenger *&lt;div&gt;+&amp;nbsp;monc:&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&amp;nbsp;&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;MonClient *&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;finisher:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Finisher *&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;osd_sessions:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;map&amp;lt;int, OSDSession*&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;Helvetica Neue&quot;&gt;homeless_session:&amp;nbsp;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;Helvetica Neue&quot;&gt;OSDSession *&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 作为非法的&amp;nbsp;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;OSDSession 使用，类似于 指针的 nullptr&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;osdmap:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;OSDMap&amp;nbsp; &amp;nbsp; *&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;crush_location:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;std::multimap&amp;lt;string,string&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;initialized:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;std::atomic&amp;lt;bool&amp;gt; = false&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&amp;nbsp;last_tid:&amp;nbsp;std::atomic&amp;lt;uint64_t&amp;gt; = 0&lt;/div&gt;&lt;div&gt;-&amp;nbsp;inflight_ops:&amp;nbsp;std::atomic&amp;lt;unsigned&amp;gt; = 0&lt;/div&gt;&lt;div&gt;-&amp;nbsp;client_inc:&amp;nbsp;std::atomic&amp;lt;int&amp;gt; = -1&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&amp;nbsp;num_in_flight:&amp;nbsp;std::atomic&amp;lt;unsigned&amp;gt; = 0&lt;/div&gt;&lt;div&gt;-&amp;nbsp;global_op_flags:&amp;nbsp;std::atomic&amp;lt;int&amp;gt; = 0&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&amp;nbsp;keep_balanced_budget: bool&lt;/div&gt;&lt;div&gt;-&amp;nbsp;honor_osdmap_full: bool&lt;/div&gt;&lt;div&gt;-&amp;nbsp;osdmap_full_try: bool&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&amp;nbsp;blacklist_events_enabled: bool&lt;/div&gt;&lt;div&gt;-&amp;nbsp;blacklist_events:&amp;nbsp;std::set&amp;lt;entity_addr_t&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&amp;nbsp;timer:&amp;nbsp;ceph::timer&amp;lt;ceph::coarse_mono_clock&amp;gt;&lt;/div&gt;&lt;div&gt;- tick_event:&amp;nbsp;uint64_t&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;linger_ops:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;map&amp;lt;uint64_t, LingerOp*&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;linger_ops_set:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;set&amp;lt;LingerOp*&amp;gt;&amp;nbsp; //&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;&amp;nbsp;we use this just to confirm a cookie is valid before dereferencing the ptr&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;poolstat_ops:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;map&amp;lt;ceph_tid_t,&amp;nbsp; PoolStatOp*&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;Helvetica Neue&quot;&gt;get_pool_stats 进行中的 op 列表&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;statfs_ops:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;map&amp;lt;ceph_tid_t, StatfsOp*&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;Helvetica Neue&quot;&gt;get_fs_stats 进行中的 op 列表&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;pool_ops:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot; class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;map&amp;lt;ceph_tid_t, PoolOp*&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;// 记录当前进行中的 pool op 有哪些&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;num_homeless_ops:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot; class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;std::atomic&amp;lt;unsigned&amp;gt; = 0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;Helvetica Neue&quot;&gt;&lt;div style=&quot;&quot;&gt;// ops waiting for an osdmap with a new pool or confirmation that&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&amp;nbsp; // the pool does not exist (may be expanded to other uses later)&lt;/div&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;Helvetica Neue&quot;&gt;check_latest_map_lingers:&amp;nbsp;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;Helvetica Neue&quot;&gt;map&amp;lt;uint64_t, LingerOp*&amp;gt;&lt;/font&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;check_latest_map_ops:&amp;nbsp;map&amp;lt;ceph_tid_t, Op*&amp;gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;check_latest_map_commands:&amp;nbsp;map&amp;lt;ceph_tid_t, CommandOp*&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;Helvetica Neue&quot;&gt;waiting_for_map:&amp;nbsp;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;Helvetica Neue&quot;&gt;map&amp;lt;epoch_t, list&amp;lt; pair&amp;lt;Context*, int&amp;gt;&amp;gt;&amp;gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;Helvetica Neue&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-22" vertex="1">
          <mxGeometry y="26" width="680" height="664" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-24" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-22" vertex="1">
          <mxGeometry y="690" width="680" height="8" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-25" value="+ Objecter::_maybe_request_map(): void&lt;div&gt;+&amp;nbsp;Objecter::_wait_for_new_map(Context *c, epoch_t epoch, int err): void&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&amp;nbsp;get_session(OSDSession *s): void&lt;/div&gt;&lt;div&gt;-&amp;nbsp;_reopen_session(OSDSession *session): void&lt;/div&gt;&lt;div&gt;-&amp;nbsp;close_session(OSDSession *session): void&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&amp;nbsp;update_crush_location(): void&amp;nbsp; // 捕获 cct 中&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;crush_location 项的更新&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;start_tick(): &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;void&amp;nbsp; // 注册事件，定时调用 tick()&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;tick(): &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;_send_command(CommandOp *c): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;command_op_cancel(OSDSession *s, ceph_tid_t tid, int r): int&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;handle_command_reply(MCommandReply *m): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;_pool_op_submit(PoolOp *op): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;pool_op_cancel(ceph_tid_t tid, int r): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;handle_pool_op_reply(MPoolOpReply *m): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;_poolstat_submit(PoolStatOp *op): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;pool_stat_op_cancel(ceph_tid_t tid, int r): int&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;handle_get_pool_stats_reply(MGetPoolStatsReply *m): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;_fs_stats_submit(StatfsOp *op): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;statfs_op_cancel(ceph_tid_t tid, int r): int&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;handle_fs_stats_reply(MStatfsReply *m): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;ms_dispatch(Message *m):&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;bool&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;override&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;handle_osd_op_reply&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;(class MOSDOpReply *m): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;handle_osd_backoff(class MOSDBackoff *m): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;handle_watch_notify(class MWatchNotify *m): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;handle_osd_map(class MOSDMap *m): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;wait_for_osd_map(): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;_prepare_osd_op(Op *op):&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;MOSDOp *&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;_send_op(Op *op): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;b&gt;+&amp;nbsp;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;b&gt;prepare_mutate_op(&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; const object_t&amp;amp; oid, const object_locator_t&amp;amp; oloc,&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; ObjectOperation&amp;amp; op, &lt;/b&gt;const SnapContext&amp;amp; snapc,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ceph::real_time mtime, int flags,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; Context *oncommit, version_t *objver = NULL,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; osd_reqid_t reqid = osd_reqid_t(),&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ZTracer::Trace *parent_trace = nullptr&lt;b&gt;): Op&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;b&gt;+ op_submit(Op *op, ceph_tid_t *ptid = NULL, int *ctx_budget = NULL): void&lt;/b&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-22" vertex="1">
          <mxGeometry y="698" width="680" height="662" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-27" value="op_target_t" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1210" y="-414" width="520" height="530" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-28" value="+ flags: int = 0&lt;div&gt;+&amp;nbsp;epoch:&amp;nbsp;epoch_t = 0&amp;nbsp; //&amp;nbsp;表示基于&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;epoch 版本的 OSDMap&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;计算的映射关系&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;base_oid:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;object_t&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 初始请求的对象 oid&lt;/div&gt;&lt;div&gt;+&amp;nbsp;base_oloc:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;object_locator_t&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 初始请求的对象 location&lt;/div&gt;&lt;div&gt;+&amp;nbsp;target_oid:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;object_t&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 由于 cache tier /&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;MOSDOpReply 等因素重定向的 对象 oid&lt;/span&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;target_oloc:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;object_locator_t&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 重定向的 location&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;precalc_pgid: bool = false&amp;nbsp; //&amp;nbsp;表示是否直接定位到 base_pgid 而不是 base_oid&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;base_pgid:&amp;nbsp;pg_t&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;//&amp;nbsp;显式的PG目标，如果存在的话，&lt;span style=&quot;background-color: initial;&quot;&gt;precalc_pgid 为 true&lt;/span&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;pgid:&amp;nbsp;pg_t&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;//&amp;nbsp;最后映射到的（原始）PG ID，没有经过 stable_mod&lt;/div&gt;&lt;div&gt;+&amp;nbsp;actual_pgid:&amp;nbsp;spg_t&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;pool_ever_existed: bool = false&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;pg_num:&amp;nbsp;unsigned = 0&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 计算映射时该 pool 的 pg_num&lt;/span&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;pg_num_mask:&amp;nbsp;unsigne&lt;span style=&quot;background-color: initial;&quot;&gt;d = 0&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;white-space: pre; background-color: initial;&quot;&gt;// 计算映射时该 pool 的 &lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;pg_num_mask&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;size: int = -1&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;white-space: pre; background-color: initial;&quot;&gt;// 计算映射时该 pool 的 size 信息&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;min_size: int = -1&lt;/span&gt;&lt;span style=&quot;background-color: initial; border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;border-color: var(--border-color); white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; border-color: var(--border-color); white-space: pre;&quot;&gt;// 计算映射时该 pool 的 &lt;span style=&quot;white-space: normal;&quot;&gt;min_size&lt;/span&gt; 信息&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;up:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;vector&amp;lt;int&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;white-space: pre; background-color: initial;&quot;&gt;// 计算映射时得到的 up osds 的集合&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;acting:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;vector&amp;lt;int&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;white-space: pre; background-color: initial;&quot;&gt;// 计算映射时得到的 &lt;/span&gt;&lt;span style=&quot;background-color: initial; white-space: pre;&quot;&gt;acting&lt;/span&gt;&lt;span style=&quot;background-color: initial; white-space: pre;&quot;&gt; osds 的集合&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;up_primary: int = -1&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// up 集合中选出的 primary osd（一般选第一个）&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;acting_primary: int = -1&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;white-space: pre; background-color: initial;&quot;&gt;acting&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;集合中选出的 primary osd（一般选第一个）&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;osd: int = -1&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;表示最终目标OSD，没有则为-1，写 op 和 大多数的 读 op 都是&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;t-&amp;gt;osd = acting_primary&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;sort_bitwise: bool = false&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;recovery_deletes: bool = false&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;used_replica: bool = false&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;paused: bool = false&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;last_force_resend:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;epoch_t = 0&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;上一次强制重新发送的epoch&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-27" vertex="1">
          <mxGeometry y="26" width="520" height="504" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-31" value="object_locator_t" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1325" y="-596" width="290" height="110" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-32" value="&lt;div&gt;// You specify either the hash or the key -- not both&lt;br&gt;&lt;/div&gt;+ pool: int64_t&amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;pool id&lt;div&gt;+&amp;nbsp;key:&amp;nbsp;string&amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;//&amp;nbsp;key string (if non-empty)&lt;/div&gt;&lt;div&gt;+&amp;nbsp;nspace:&amp;nbsp;string&amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;namespace&lt;/div&gt;&lt;div&gt;+&amp;nbsp;hash:&amp;nbsp;int64_t&amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;hash position (if &amp;gt;= 0)&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-31" vertex="1">
          <mxGeometry y="26" width="290" height="84" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-35" value="该结构封装了对象所在的PG，以及PG对应的OSD列表等信息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d6b656;fillColor=#fff2cc;fontFamily=Helvetica;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1300" y="-446" width="350" height="30" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-36" value="Op" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-740" y="825" width="610" height="590" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-37" value="+ session: OSDSession * = NULL&amp;nbsp; // OSD的相关Session 信息，session 是关于connect的信息&lt;div&gt;+&amp;nbsp;incarnation: int = 0&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;// session 的引用次数&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;+&amp;nbsp;target:&amp;nbsp;op_target_t&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 地址信息&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;tid:&amp;nbsp; &amp;nbsp; &amp;nbsp;ceph_tid_t = 0&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 请求的事务 ID&lt;/div&gt;&lt;div&gt;+&amp;nbsp;reqid:&amp;nbsp;osd_reqid_t&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;Osd请求标识符：调用者 name(entity_name_t) +&amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;tid(ceph_tid_t) +&lt;/span&gt;&lt;span style=&quot;background-color: initial; white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;background-color: initial; white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;background-color: initial; white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;background-color: initial; white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;background-color: initial; white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;background-color: initial; white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;background-color: initial; white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;// incarnation(int32_t) 唯一标识此请求&lt;/span&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;attempts:&amp;nbsp;int = 0&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 尝试次数&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;con:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; ConnectionRef =&amp;nbsp;NULL&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;//&amp;nbsp;for rx buffer only&lt;/div&gt;&lt;div&gt;+&amp;nbsp;features:&amp;nbsp;uint64_t&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp;=&amp;nbsp;CEPH_FEATURES_SUPPORTED_DEFAULT&amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;//&amp;nbsp;explicitly specified op features&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;ops:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;vector&amp;lt;OSDOp&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 多个操作的封装&lt;/div&gt;&lt;div&gt;+&amp;nbsp;outbl:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;bufferlist *&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 输出的 bufferlist&lt;/div&gt;&lt;div&gt;+&amp;nbsp;out_bl:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;vector&amp;lt;bufferlist*&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;// 每个操作对应的 bufferlist&lt;/div&gt;&lt;div&gt;+&amp;nbsp;out_handler:&amp;nbsp;vector&amp;lt;Context*&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;// 每个操作对应的 回调函数&lt;/div&gt;&lt;div&gt;+&amp;nbsp;out_rval:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;vector&amp;lt;int*&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;// 每个操作对应的输出结果&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;priority: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;int = 0&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;操作的优先级，它可以影响 OSD 内的操作顺序&lt;/div&gt;&lt;div&gt;+&amp;nbsp;onfinish: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;Context&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 操作完成后的回调&lt;/div&gt;&lt;div&gt;+&amp;nbsp;ontimeout:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;uint64_t = 0&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;操作的超时值，超过该值未完成，则可能会被视为失败&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;objver:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp;version_t *&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 将此次操作完成后对应对象的 user_version 返回回来&lt;/div&gt;&lt;div&gt;+ reply_epoch:&amp;nbsp;epoch_t * =&amp;nbsp;NULL&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 操作回复时 OSDMap 的 epoch&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;mtime:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;ceph::real_time&lt;span style=&quot;border-color: var(--border-color); white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 客户端调用这个操作的时间&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;stamp:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;ceph::coarse_mono_time&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 这个操作在 Objecter 真正开始的时间戳&lt;/div&gt;&lt;div&gt;+&amp;nbsp;map_dne_bound:&amp;nbsp;epoch_t&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;指定操作映射有效且不存在超出的 epoch 边界&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;budgeted: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;bool = false&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 是否控制调用者下发 op 的速度&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;should_resend: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;bool&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;= false&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;// 决定失败时是否重发&lt;/span&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;ctx_budgeted: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;bool&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;= false&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;设置后，表示节流预算是针对一系列操作而不是针对每个操作进行管理&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;data_offset: int *&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;表示操作的数据偏移量的整数的指针，可从指定位置开始读写&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;snapid:&amp;nbsp;snapid_t =&amp;nbsp;CEPH_NOSNAP&amp;nbsp; &amp;nbsp;// 快照的 id&lt;/div&gt;&lt;div&gt;+&amp;nbsp;snapc:&amp;nbsp;SnapContext&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;// pool 层级的 快照信息&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-36" vertex="1">
          <mxGeometry y="26" width="610" height="564" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-40" value="结构Op封装了完成一个操作的相关上下文信息，包括target地址信息、链接信息等。&lt;span style=&quot;background-color: initial;&quot;&gt;允许一个常规的 I/O 操作，&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;如读取、写入、删除或者引用对象。这是沟通的操作类型，客户端与存储在 Ceph 集群中的数据进行交互。&lt;/span&gt;&lt;span style=&quot;background-color: initial; color: rgba(0, 0, 0, 0); font-family: monospace; font-size: 0px; text-align: start;&quot;&gt;%3CmxGraphModel%3E%3Croot%3E%3CmxCell%20id%3D%220%22%2F%3E%3CmxCell%20id%3D%221%22%20parent%3D%220%22%2F%3E%3CmxCell%20id%3D%222%22%20value%3D%22%E6%8C%87%E7%9A%84%E6%98%AF%E5%85%81%E8%AE%B8%E4%B8%80%E4%B8%AA%E5%B8%B8%E8%A7%84%E7%9A%84%20I%2FO%20%E6%93%8D%E4%BD%9C%EF%BC%8C%E5%A6%82%E8%AF%BB%E5%8F%96%E3%80%81%E5%86%99%E5%85%A5%E3%80%81%E5%88%A0%E9%99%A4%E6%88%96%E8%80%85%E5%BC%95%E7%94%A8%E5%AF%B9%E8%B1%A1%E3%80%82%E8%BF%99%E6%98%AF%E6%B2%9F%E9%80%9A%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8E%E5%AD%98%E5%82%A8%E5%9C%A8%20Ceph%20%E9%9B%86%E7%BE%A4%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E4%BA%A4%E4%BA%92%E3%80%82%22%20style%3D%22text%3Bhtml%3D1%3Balign%3Dcenter%3BverticalAlign%3Dmiddle%3Bresizable%3D0%3Bpoints%3D%5B%5D%3Bautosize%3D1%3BstrokeColor%3Dnone%3BfillColor%3Dnone%3BfontFamily%3DHelvetica%3BfontSize%3D12%3BfontColor%3Ddefault%3B%22%20vertex%3D%221%22%20parent%3D%221%22%3E%3CmxGeometry%20x%3D%22775%22%20y%3D%221058%22%20width%3D%22770%22%20height%3D%2230%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3C%2Froot%3E%3C%2FmxGraphModel%3E&lt;/span&gt;&lt;span style=&quot;background-color: initial; color: rgba(0, 0, 0, 0); font-family: monospace; font-size: 0px; text-align: start;&quot;&gt;%3CmxGraphModel%3E%3Croot%3E%3CmxCell%20id%3D%220%22%2F%3E%3CmxCell%20id%3D%221%22%20parent%3D%220%22%2F%3E%3CmxCell%20id%3D%222%22%20value%3D%22%E6%8C%87%E7%9A%84%E6%98%AF%E5%85%81%E8%AE%B8%E4%B8%80%E4%B8%AA%E5%B8%B8%E8%A7%84%E7%9A%84%20I%2FO%20%E6%93%8D%E4%BD%9C%EF%BC%8C%E5%A6%82%E8%AF%BB%E5%8F%96%E3%80%81%E5%86%99%E5%85%A5%E3%80%81%E5%88%A0%E9%99%A4%E6%88%96%E8%80%85%E5%BC%95%E7%94%A8%E5%AF%B9%E8%B1%A1%E3%80%82%E8%BF%99%E6%98%AF%E6%B2%9F%E9%80%9A%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8E%E5%AD%98%E5%82%A8%E5%9C%A8%20Ceph%20%E9%9B%86%E7%BE%A4%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E4%BA%A4%E4%BA%92%E3%80%82%22%20style%3D%22text%3Bhtml%3D1%3Balign%3Dcenter%3BverticalAlign%3Dmiddle%3Bresizable%3D0%3Bpoints%3D%5B%5D%3Bautosize%3D1%3BstrokeColor%3Dnone%3BfillColor%3Dnone%3BfontFamily%3DHelvetica%3BfontSize%3D12%3BfontColor%3Ddefault%3B%22%20vertex%3D%221%22%20parent%3D%221%22%3E%3CmxGeometry%20x%3D%22775%22%20y%3D%221058%22%20width%3D%22770%22%20height%3D%2230%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3C%2Froot%3E%3C%2FmxGraphModel%3E&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#6c8ebf;fillColor=#dae8fc;fontFamily=Helvetica;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-735" y="769" width="610" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-41" value="PoolStatOp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="38" y="839" width="160" height="86" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-42" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-41" vertex="1">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-43" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-41" vertex="1">
          <mxGeometry y="52" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-44" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-41" vertex="1">
          <mxGeometry y="60" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-45" value="StatfsOp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="521" y="839" width="160" height="86" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-46" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-45" vertex="1">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-47" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-45" vertex="1">
          <mxGeometry y="52" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-48" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-45" vertex="1">
          <mxGeometry y="60" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-49" value="PoolOp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1025" y="839" width="160" height="86" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-50" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-49" vertex="1">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-51" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-49" vertex="1">
          <mxGeometry y="52" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-52" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-49" vertex="1">
          <mxGeometry y="60" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-53" value="CommandOp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1590" y="829" width="160" height="86" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-54" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-53" vertex="1">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-55" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-53" vertex="1">
          <mxGeometry y="52" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-56" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-53" vertex="1">
          <mxGeometry y="60" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-57" value="LingerOp" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2240" y="829" width="160" height="86" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-58" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-57" vertex="1">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-59" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-57" vertex="1">
          <mxGeometry y="52" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-60" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-57" vertex="1">
          <mxGeometry y="60" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-63" value="用于发送控制命令到集群。例如，管理员可能需要查询集群状态、调整参数或执行特定的管理任务。&lt;span style=&quot;background-color: initial;&quot;&gt;CommandOp&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;使客户端能够发送这些命令并接收响应。它通常用于执行非数据路径的操作，如获取集群或OSD的状态信息。&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#6c8ebf;fillColor=#dae8fc;fontFamily=Helvetica;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1390" y="769" width="620" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-64" value="用于对存储池进行操作，例如创建、删除、更新或获取存储池的属性。&lt;span style=&quot;background-color: initial;&quot;&gt;存储池是&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Ceph 中&lt;/span&gt;&lt;div&gt;管理数据分配和复制策略的一个逻辑分组，PoolOp使得客户端能够管理这些池的配置&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#6c8ebf;fillColor=#dae8fc;fontFamily=Helvetica;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="880" y="769" width="490" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-65" value="用于获取文件系统的统计信息，如总空间、可用空间和使用空间。这类似于传统文件系统&lt;div&gt;中的statfs或df命令。&lt;span style=&quot;background-color: initial;&quot;&gt;在 Ceph 中，StatfsOp允许客户端查询整个集群的容量和使用情况&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#6c8ebf;fillColor=#dae8fc;fontFamily=Helvetica;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="370" y="769" width="490" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-69" value="在 Ceph 中用于管理持久的监视和通知操作，允许客户端监视对象的变化并接收相关事件的通知" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#6c8ebf;fillColor=#dae8fc;fontFamily=Helvetica;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2040" y="774" width="530" height="30" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-71" value="用于获取特定存储池的统计信息，如对象数量、存储空间使用情况等。&lt;div&gt;如果想要了解单个存储池的性能和容量指标，PoolStatOp提供必要的操作&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#6c8ebf;fillColor=#dae8fc;fontFamily=Helvetica;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-72" y="769" width="410" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-74" value="&lt;font style=&quot;font-size: 54px;&quot;&gt;对象处理层（OSDC）&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontFamily=Helvetica;fontSize=12;fontColor=default;fontStyle=1" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-1030" y="-690" width="560" height="80" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-75" value="" style="endArrow=open;startArrow=circlePlus;endFill=0;startFill=0;endSize=8;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.5;exitY=1.004;exitDx=0;exitDy=0;exitPerimeter=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-25" target="vteJUobceDA6RaGQ8-ky-36" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="720" y="480" as="sourcePoint" />
            <mxPoint x="1480" y="650" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-76" value="inner class" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="vteJUobceDA6RaGQ8-ky-75" vertex="1" connectable="0">
          <mxGeometry x="0.0747" y="5" relative="1" as="geometry">
            <mxPoint x="231" y="-33" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-77" value="" style="endArrow=open;startArrow=circlePlus;endFill=0;startFill=0;endSize=8;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;exitX=0.502;exitY=1.018;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitPerimeter=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-25" target="vteJUobceDA6RaGQ8-ky-41" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="-40" y="1177.99" as="sourcePoint" />
            <mxPoint x="563.3599999999997" y="904.0199999999998" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-78" value="inner class" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="vteJUobceDA6RaGQ8-ky-77" vertex="1" connectable="0">
          <mxGeometry x="0.0747" y="5" relative="1" as="geometry">
            <mxPoint x="151" y="-45" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-79" value="" style="endArrow=open;startArrow=circlePlus;endFill=0;startFill=0;endSize=8;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.498;exitY=0.996;exitDx=0;exitDy=0;exitPerimeter=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-25" target="vteJUobceDA6RaGQ8-ky-45" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="710" y="480" as="sourcePoint" />
            <mxPoint x="731" y="496" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-80" value="inner class" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="vteJUobceDA6RaGQ8-ky-79" vertex="1" connectable="0">
          <mxGeometry x="0.0747" y="5" relative="1" as="geometry">
            <mxPoint x="22" y="-37" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-83" value="" style="endArrow=open;startArrow=circlePlus;endFill=0;startFill=0;endSize=8;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.485;exitY=1.002;exitDx=0;exitDy=0;exitPerimeter=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-25" target="vteJUobceDA6RaGQ8-ky-53" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="697.1428571428571" y="490" as="sourcePoint" />
            <mxPoint x="727" y="494" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-84" value="inner class" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="vteJUobceDA6RaGQ8-ky-83" vertex="1" connectable="0">
          <mxGeometry x="0.0747" y="5" relative="1" as="geometry">
            <mxPoint x="-127" y="-15" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-85" value="" style="endArrow=open;startArrow=circlePlus;endFill=0;startFill=0;endSize=8;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;exitX=0.481;exitY=1.011;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-25" target="vteJUobceDA6RaGQ8-ky-57" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="1680" y="760" as="sourcePoint" />
            <mxPoint x="720" y="490" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-86" value="inner class" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="vteJUobceDA6RaGQ8-ky-85" vertex="1" connectable="0">
          <mxGeometry x="0.0747" y="5" relative="1" as="geometry">
            <mxPoint x="-294" y="-18" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-88" value="" style="endArrow=open;startArrow=circlePlus;endFill=0;startFill=0;endSize=8;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=-0.008;entryY=0.21;entryDx=0;entryDy=0;entryPerimeter=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-23" target="vteJUobceDA6RaGQ8-ky-28" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="2330" y="760" as="sourcePoint" />
            <mxPoint x="730" y="500" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-89" value="inner class" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="vteJUobceDA6RaGQ8-ky-88" vertex="1" connectable="0">
          <mxGeometry x="0.0747" y="5" relative="1" as="geometry">
            <mxPoint x="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-81" value="" style="endArrow=open;startArrow=circlePlus;endFill=0;startFill=0;endSize=8;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.485;exitY=1.002;exitDx=0;exitDy=0;exitPerimeter=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-25" target="vteJUobceDA6RaGQ8-ky-49" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="710" y="480" as="sourcePoint" />
            <mxPoint x="729" y="498" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-82" value="inner class" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="vteJUobceDA6RaGQ8-ky-81" vertex="1" connectable="0">
          <mxGeometry x="0.0747" y="5" relative="1" as="geometry">
            <mxPoint x="-73" y="-30" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-90" value="&lt;b style=&quot;font-size: 20px;&quot;&gt;对象处理层 与 IO处理层 数据操作交互的接口，上层将操作转换为&amp;nbsp;&lt;span style=&quot;text-wrap: wrap;&quot;&gt;ObjectOperation，调用 Objecter 相应方法 将其转换为特定的 Op 发送出去&lt;/span&gt;&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;fontFamily=Helvetica;fontSize=12;portConstraint=none;perimeter=none;resizeWidth=1;overflow=width;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="345" y="1470" width="1280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-91" value="" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;arcSize=42;fontFamily=Helvetica;fontSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-1070" y="1880" width="3870" height="1430" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-92" value="librados::ObjectOperation" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-745" y="3583" width="600" height="230" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-93" value="# impl:&amp;nbsp;ObjectOperationImpl *" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-92" vertex="1">
          <mxGeometry y="26" width="600" height="34" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-94" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-92" vertex="1">
          <mxGeometry y="60" width="600" height="8" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-95" value="+ cmpxattr(const char *name, uint8_t op, const bufferlist&amp;amp; val): void&lt;div&gt;+&amp;nbsp;cmpxattr(const char *name, uint8_t op, uint64_t v): void&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;exec(const char *cls, const char *method, bufferlist&amp;amp; inbl): void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;exec(const char *cls, const char *method, bufferlist&amp;amp; inbl, bufferlist *obl, int *prval): void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;exec(const char *cls, const char *method, bufferlist&amp;amp; inbl, ObjectOperationCompletion *completion): void&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;assert_version(uint64_t ver): void&amp;nbsp; // 断言对象的版本&lt;/div&gt;&lt;div&gt;+&amp;nbsp;assert_exists(): void&amp;nbsp; // 断言对象是否存在&lt;/div&gt;&lt;div&gt;+&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;omap_cmp(&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;const std::map&amp;lt;std::string, std::pair&amp;lt;bufferlist, int&amp;gt; &amp;gt; &amp;amp;assertions,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;int *prval): void&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-92" vertex="1">
          <mxGeometry y="68" width="600" height="162" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-96" value="ObjectWriteOperation" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-1005" y="3967" width="400" height="350" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-97" value="+ unused: time_t *" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-96" vertex="1">
          <mxGeometry y="26" width="400" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-98" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-96" vertex="1">
          <mxGeometry y="52" width="400" height="8" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-99" value="+ create(bool exclusive): void&lt;div&gt;+&amp;nbsp;write(uint64_t off, const bufferlist&amp;amp; bl): void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;write_full(const bufferlist&amp;amp; bl): void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;append(const bufferlist&amp;amp; bl): void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;remove(): void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;truncate(uint64_t off): void&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;rmxattr(const char *name): void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;cmpxattr(const char *name, uint8_t op, const bufferlist&amp;amp; val): void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;setxattr(const char *name, const bufferlist&amp;amp; bl): void&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;omap_set(const std::map&amp;lt;std::string, bufferlist&amp;gt; &amp;amp;map): void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;omap_set_header(const bufferlist &amp;amp;bl): void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;omap_clear(): void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;omap_rm_keys(const std::set&amp;lt;std::string&amp;gt; &amp;amp;to_rm): void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;copy_from2(const std::string&amp;amp; src, const IoCtx&amp;amp; src_ioctx,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; uint64_t src_version, uint32_t src_fadvise_flags): void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;set_redirect(const std::string&amp;amp; tgt_obj, const IoCtx&amp;amp; tgt_ioctx,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;uint64_t tgt_version, int flag = 0): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-96" vertex="1">
          <mxGeometry y="60" width="400" height="290" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-100" value="ObjectReadOperation" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-255" y="3967" width="500" height="210" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-101" value="no filed" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-100" vertex="1">
          <mxGeometry y="26" width="500" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-102" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-100" vertex="1">
          <mxGeometry y="52" width="500" height="8" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-103" value="+ stat2(uint64_t *psize, struct timespec *pts, int *prval): void&lt;div&gt;+&amp;nbsp;getxattr(const char *name, bufferlist *pbl, int *prval): void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;getxattrs(std::map&amp;lt;std::string, bufferlist&amp;gt; *pattrs, int *prval): void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;read(size_t off, uint64_t len, bufferlist *pbl, int *prval): void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;omap_get_vals2(...&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;omap_get_keys2(....&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;omap_get_header(bufferlist *header, int *prval): void&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;.......&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-100" vertex="1">
          <mxGeometry y="60" width="500" height="150" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-104" value="ObjectOperationImpl" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-1066" y="2250" width="230" height="90" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-105" value="+ o:&amp;nbsp; &amp;nbsp;::ObjectOperation&lt;div&gt;+&amp;nbsp;rt:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; real_time&lt;/div&gt;&lt;div&gt;+ prt:&amp;nbsp;&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;real_time&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;*&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-104" vertex="1">
          <mxGeometry y="26" width="230" height="64" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-112" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;entryX=0.488;entryY=1.026;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-96" target="vteJUobceDA6RaGQ8-ky-95" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="-775" y="3837" as="sourcePoint" />
            <mxPoint x="-615" y="3837" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-113" value="Extends" style="endArrow=block;endSize=16;endFill=0;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-100" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="-795" y="3977" as="sourcePoint" />
            <mxPoint x="-455" y="3817" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-115" value="RadosClient : public Dispatcher" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1230" y="2170" width="710" height="1010" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-116" value="&lt;div&gt;+&amp;nbsp;conf:&amp;nbsp;md_config_t *&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 配置文件&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;- state:&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;enum {&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;DISCONNECTED,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;CONNECTING,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;CONNECTED,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;}&amp;nbsp; // 和 monitor 的网络连接状态&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;monclient:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;MonClient&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// Monitor 客户端&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;mgrclient:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;MgrClient&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// Manager 客户端&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;messenger:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Messenger *&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 网络消息接口，自己 new&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;objecter:&amp;nbsp;&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Objecter *&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 自己 new，并把&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;monclient 和&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;messenger 传给&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Objecter&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;instance_id: uint64_t&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 向 Mon 申请的标识自己的 id&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;finisher:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Finisher&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp;// 内部有线程，专门处理一些回调&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;lock:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Mutex&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;cond:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Cond&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;refcnt:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// RadosClient 的引用计数，自己实现了 get() / put()，没有继承&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center; background-color: initial;&quot;&gt;RefCountedObject&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;log_last_version:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;version_t&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;log_cb:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;rados_log_callback_t&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;log_cb2:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;rados_log_callback2_t&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;log_cb_arg:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;void *&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;log_watch:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;string&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;//&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;mgrclient.service_daemon_register(service_name, daemon_name,&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;daemon_metadata)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;// 这些信息会注册到 mgr，（&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;osd，&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;mds，&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;client，mon，mgr 不需注册）&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;service_daemon:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;bool = false&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;// 标识此 client 是否已经注册守护进程到 mgr&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;daemon_name: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;string&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 守护进程类型，eg：rgw&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;service_name: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;string&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 守护进程的名称，eg：&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;gw1&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;daemon_metadata:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;map&amp;lt;string, string&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 注册是提供的 元信息&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-115" vertex="1">
          <mxGeometry y="26" width="710" height="424" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-117" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-115" vertex="1">
          <mxGeometry y="450" width="710" height="8" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-118" value="&lt;div&gt;// 1.&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;初始化 自Dispatcher 继承的 CephContext*&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;// 2. get monmon&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;// 3. 初始化 Messenger(client 角色)+ 为 messenger 设置策略&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;// 4. 初始化 objecter&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;// 5. 把&amp;nbsp;monclient 和&amp;nbsp;mgrclient 通信使用的 messenger 设置为 刚初始化的&lt;/span&gt;&lt;span style=&quot;background-color: initial; border-color: var(--border-color);&quot;&gt;messenger&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; border-color: var(--border-color);&quot;&gt;// 6. Messenger 的 dispatcher 设置顺序为&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial; border-color: var(--border-color);&quot;&gt;mgrclient，&lt;/span&gt;&lt;span style=&quot;background-color: initial; border-color: var(--border-color);&quot;&gt;objecter 以及 自身(RadosClient)&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; border-color: var(--border-color);&quot;&gt;// 7. 向 mgr 注册自身 等等&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; border-color: var(--border-color);&quot;&gt;// 8.&amp;nbsp;monclient.init() +&amp;nbsp;monclient.authenticate()&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; border-color: var(--border-color);&quot;&gt;// 9.&amp;nbsp;mgrclient.init()&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; border-color: var(--border-color);&quot;&gt;// 10.&amp;nbsp;messenger-&amp;gt;start() +&amp;nbsp;objecter-&amp;gt;start() +&amp;nbsp;finisher.start()&lt;/span&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;connect():&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// RadosClient 的初始化函数&lt;/div&gt;&lt;div&gt;+&amp;nbsp;shutdown(): &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;void&lt;/div&gt;&lt;div&gt;+&amp;nbsp;ping_monitor(string mon_id, string *result): int&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;+ create_ioctx(const char *name, &lt;b&gt;IoCtxImpl **io&lt;/b&gt;): int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 创建一个 pool 相关的上下文 IoCtxImpl 对象&lt;div&gt;+&amp;nbsp;lookup_pool(const char *name): int64_t&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;async_watch_flush(&lt;b&gt;AioCompletionImpl *c&lt;/b&gt;): int&lt;/div&gt;&lt;div&gt;+&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;pool_create_async(string&amp;amp; name, &lt;b&gt;PoolAsyncCompletionImpl *c&lt;/b&gt;, unsigned long long auid=0,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;int16_t crush_rule=-1): int&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;pool_list(std::list&amp;lt;std::pair&amp;lt;int64_t, string&amp;gt; &amp;gt;&amp;amp; ls): int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// pool 相关信息存储在 OSDMap 中&lt;/div&gt;&lt;div&gt;+&amp;nbsp;get_pool_stats(std::list&amp;lt;string&amp;gt;&amp;amp; ls, map&amp;lt;string,::pool_stat_t&amp;gt;&amp;amp; result): int&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;//&amp;nbsp;同步创建pool。调用Objecter:create_pool函数，构造PoolOp操作，通过Monitor的客户端monc发送请求给Monitor创建一个pool,并同步等待请求的返回。&lt;/div&gt;&lt;div&gt;+&amp;nbsp;pool_create(string&amp;amp; name, unsigned long long auid=0, int16_t crush_rule=-1): int&lt;/div&gt;&lt;div&gt;+&amp;nbsp;pool_delete(const char *name): int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 过程和 create 类似&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;//&amp;nbsp;&lt;span style=&quot;font-family: &amp;quot;PingFang SC&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;函数mon_command处理Monitor相关的命令，它调用函数monclient.start_mon_command把命令发送给Monitor处理&lt;/span&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;mon_command(const vector&amp;lt;string&amp;gt;&amp;amp; cmd, const bufferlist &amp;amp;inbl,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;bufferlist *outbl, string *outs): int&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;PingFang SC&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;函数&lt;/span&gt;mgr_command&lt;span style=&quot;font-family: &amp;quot;PingFang SC&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;处理MGR相关的命令，它调用函数&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font face=&quot;PingFang SC&quot;&gt;mgrclient.start_command&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-family: &amp;quot;PingFang SC&amp;quot;; font-size: 13px;&quot;&gt;把命令发送给对应MGR处理&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;mgr_command(const vector&amp;lt;string&amp;gt;&amp;amp; cmd, const bufferlist &amp;amp;inbl,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;bufferlist *outbl, string *outs): int&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;PingFang SC&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;函数osd_command处理OSD相关的命令，它调用函数objecter-&amp;gt;osd_command把命令发送给对应OSD处理&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;osd_command(int osd, vector&amp;lt;string&amp;gt;&amp;amp; cmd, const bufferlist&amp;amp; inbl,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;bufferlist *poutbl, string *prs): int&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;PingFang SC&amp;quot;; font-size: 13px; background-color: initial;&quot;&gt;函数pg_command处理PG相关的命令，它调用函数objecter-&amp;gt;pg_command把命令发送给该PG的主OSD来处理&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;pg_command(pg_t pgid, vector&amp;lt;string&amp;gt;&amp;amp; cmd, const bufferlist&amp;amp; inbl,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;bufferlist *poutbl, string *prs): int&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-115" vertex="1">
          <mxGeometry y="458" width="710" height="552" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-119" value="&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;OSDC(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;PingFang SC&amp;quot;; font-size: 13px; text-align: start; text-wrap: wrap; background-color: initial;&quot;&gt;osd client&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;) 模块&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;实现了请求的封装和通过网络模块发送请求的逻辑，&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;其核心类Objecter完成对象的地址计&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;算、消息的发送等工作。&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;PingFang SC&amp;quot;; font-size: 13px; text-align: start; text-wrap: wrap; background-color: initial;&quot;&gt;OSDC是客户端底层的模块，其核心在于封装操作数据，计算对象地址、发送请求和处理超时。&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;PingFang SC&amp;quot;; font-size: 13px; text-align: start; text-wrap: wrap; background-color: initial;&quot;&gt;该目录下封装了各类操作osd的方法。objecter最终会创建一个操作，并且把它提交。&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#9673a6;fillColor=#e1d5e7;fontFamily=Helvetica;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-490" y="-680" width="750" height="60" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-120" value="IoCtx" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="620" y="3583" width="950" height="260" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-121" value="+ io_ctx_impl:&amp;nbsp;IoCtxImpl *" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-120" vertex="1">
          <mxGeometry y="26" width="950" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-122" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-120" vertex="1">
          <mxGeometry y="52" width="950" height="8" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-123" value="&lt;div&gt;&lt;b&gt;+&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;IoCtx(IoCtxImpl *io_ctx_impl_)&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;: io_ctx_impl(io_ctx_impl_) {}&amp;nbsp;&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 不是 new，是外界传递&lt;/span&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;+ write(const std::string&amp;amp; oid, bufferlist&amp;amp; bl, size_t len, uint64_t off): int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;//&amp;nbsp;io_ctx_impl-&amp;gt;write(obj, bl, len, off)&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;aio_read(const std::string&amp;amp; oid, &lt;b&gt;AioCompletion *c&lt;/b&gt;,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;bufferlist *pbl, size_t len, uint64_t off): int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;io_ctx_impl-&amp;gt;aio_read(...)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;operate(const std::string&amp;amp; oid, ObjectWriteOperation *op, bool skip_cache = false): int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;io_ctx_impl-&amp;gt;operate(...)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;operate(const std::string&amp;amp; oid, ObjectReadOperation *op, int flags, bufferlist *pbl): int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;io_ctx_impl-&amp;gt;operate_read(...)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;aio_operate(const std::string&amp;amp; oid, AioCompletion *c, &lt;b&gt;ObjectWriteOperation *op&lt;/b&gt;, int flags): int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;io_ctx_impl-&amp;gt;aio_operate(...)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;aio_operate(const std::string&amp;amp; oid, AioCompletion *c,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;b&gt;ObjectReadOperation *op&lt;/b&gt;, int flags,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;bufferlist *pbl): int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;io_ctx_impl-&amp;gt;aio_operate_read(...)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;aio_exec(const std::string&amp;amp; oid, AioCompletion *c, const char *cls, const char *method,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;bufferlist&amp;amp; inbl, bufferlist *outbl): int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;io_ctx_impl-&amp;gt;aio_exec(...)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;omap_set(const std::string&amp;amp; oid,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;const map&amp;lt;string, bufferlist&amp;gt;&amp;amp; m): int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// { librados::&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;ObjectWriteOperation op;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;op.omap_set(m);&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;return operate(oid, &amp;amp;op); }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;......&lt;/span&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-120" vertex="1">
          <mxGeometry y="60" width="950" height="200" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-124" value="librados::&lt;span style=&quot;text-align: left; text-wrap: wrap;&quot;&gt;ObjectOperation 只是给用户使用的，之后会 通过 IoCtx 将内部的 ::&lt;/span&gt;&lt;span style=&quot;text-align: left; text-wrap: wrap;&quot;&gt;&amp;nbsp;ObjectOperation 传到 IoCtxImpl 中处理&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#82b366;fillColor=#d5e8d4;fontFamily=Helvetica;fontSize=12;overflow=width;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="785" y="3504" width="640" height="30" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-125" value="IoCtxImpl" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-400" y="2170" width="790" height="450" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-126" value="+ ref_cnt:&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp;std::atomic&amp;lt;uint64_t&amp;gt; = 0&amp;nbsp; // IoCtxImpl 的引用计数（看看在那初始化，全局有几个）&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;objecter:&amp;nbsp;Objecter *&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;// 用来调用方法，eg：将&amp;nbsp;::ObjectOperation 转换为 Objecter::Op&lt;/div&gt;&lt;div&gt;+&amp;nbsp;client:&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp;&amp;nbsp;RadosClient *&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 调用&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;client 的一些方法，比如 cct，&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;mon_command，finish 处理 context 等&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;poolid:&amp;nbsp;int64_t&lt;/div&gt;&lt;div&gt;+&amp;nbsp;snap_seq:&amp;nbsp;snapid_t&lt;/div&gt;&lt;div&gt;+&amp;nbsp;snapc: (::SnapContext)&lt;/div&gt;&lt;div&gt;+&amp;nbsp;assert_ver:&amp;nbsp;uint64_t&lt;/div&gt;&lt;div&gt;+&amp;nbsp;last_objver:&amp;nbsp;version_t&lt;/div&gt;&lt;div&gt;+&amp;nbsp;notify_timeout:&amp;nbsp;uint32_t&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;oloc:&amp;nbsp;object_locator_t&lt;/div&gt;&lt;div&gt;+&amp;nbsp;aio_write_list_lock:&amp;nbsp;Mutex&lt;/div&gt;&lt;div&gt;+&amp;nbsp;aio_write_seq:&amp;nbsp;ceph_tid_t&lt;/div&gt;&lt;div&gt;+&amp;nbsp;aio_write_cond:&amp;nbsp;Cond&lt;/div&gt;&lt;div&gt;+&amp;nbsp;aio_write_list:&amp;nbsp;xlist&amp;lt;AioCompletionImpl*&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp; 专门存放 AIO 操作的回调&lt;/div&gt;&lt;div&gt;+&amp;nbsp;aio_write_waiters:&amp;nbsp;map&amp;lt;ceph_tid_t, std::list&amp;lt;AioCompletionImpl*&amp;gt;&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-125" vertex="1">
          <mxGeometry y="26" width="790" height="284" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-127" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-125" vertex="1">
          <mxGeometry y="310" width="790" height="8" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-128" value="// 一堆具体的方法&amp;nbsp; + 处理&amp;nbsp;AioCompletion 的 Context（都是包含 AioCompletionImpl）&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;operate(const object_t&amp;amp; oid, &lt;b&gt;::ObjectOperation *o&lt;/b&gt;, ceph::real_time *pmtime, int flags=0): int&lt;/div&gt;&lt;div&gt;+&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;aio_operate(const object_t&amp;amp; oid, &lt;b&gt;::ObjectOperation *o&lt;/b&gt;,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;b&gt;AioCompletionImpl *c&lt;/b&gt;, ...&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;): int&lt;/span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;//&amp;nbsp;Context *oncommit = new C_SafeCond(&amp;amp;mylock, &amp;amp;cond, &amp;amp;done, &amp;amp;r);&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 完成后（peer 端回复成功）会被调用&lt;/div&gt;&lt;div&gt;//&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;Objecter::Op *objecter_op = objecter-&amp;gt;prepare_mutate_op(oid, oloc,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;*o, snapc, ut, flags,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;oncommit, &amp;amp;ver);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;// objecter-&amp;gt;op_submit(objecter_op)&lt;/span&gt;&amp;nbsp;&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-125" vertex="1">
          <mxGeometry y="318" width="790" height="132" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-129" value="OSDSession" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-610" y="-410" width="590" height="300" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-130" value="&lt;div&gt;// pending ops&lt;br&gt;&lt;/div&gt;+ ops: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;map&amp;lt;ceph_tid_t,Op*&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 在发送前会调用&amp;nbsp;_session_op_assign 将 op&amp;nbsp;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;// 放到 session 的队列，用于后续超时等事件的寻找&lt;span style=&quot;color: rgba(0, 0, 0, 0); font-family: monospace; font-size: 0px; text-wrap: nowrap;&quot;&gt;%3CmxGraphModel%3E%3Croot%3E%3CmxCell%20id%3D%220%22%2F%3E%3CmxCell%20id%3D%221%22%20parent%3D%220%22%2F%3E%3CmxCell%20id%3D%222%22%20value%3D%22%22%20style%3D%22rounded%3D0%3BwhiteSpace%3Dwrap%3Bhtml%3D1%3Balign%3Dcenter%3BverticalAlign%3Dmiddle%3BarcSize%3D42%3BfontFamily%3DHelvetica%3BfontSize%3D12%3BfillColor%3D%23d5e8d4%3BstrokeColor%3D%2382b366%3B%22%20vertex%3D%221%22%20parent%3D%221%22%3E%3CmxGeometry%20x%3D%22-1070%22%20y%3D%22-730%22%20width%3D%223870%22%20height%3D%222600%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3C%2Froot%3E%3C%2FmxGraphModel%3E&lt;/span&gt;&lt;div&gt;+&amp;nbsp;linger_ops:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;map&amp;lt;uint64_t, LingerOp*&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;linger_ops 的列表&lt;/span&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;command_ops:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;map&amp;lt;ceph_tid_t,CommandOp*&amp;gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;_session_command_op_assign&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;// backoffs&lt;br&gt;&lt;/div&gt;&lt;div&gt;backoffs:&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;map&amp;lt;spg_t, map&amp;lt;hobject_t,OSDBackoff&amp;gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;backoffs_by_id:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;map&amp;lt;uint64_t,OSDBackoff*&amp;gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;osd:&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// session peer 端 OSD 的编号&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;incarnation: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// session 的引用计数&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;con:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;ConnectionRef&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// session 绑定的 con&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;num_locks: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;int &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 配置&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;objecter_completion_locks_per_session 初始化&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;completion_locks:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;std::unique_ptr&amp;lt;std::mutex[]&amp;gt;&amp;nbsp; // 初始化&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;num_locks 个锁&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-129" vertex="1">
          <mxGeometry y="26" width="590" height="274" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-133" value="Rados" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1860" y="3583" width="660" height="198" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-134" value="+ client: RadosClient *&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 不是自己 new，Rados(IoCtx &amp;amp;ioctx):&amp;nbsp;client(ioctx.io_ctx_impl-&amp;gt;client) 赋值&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 或者调用&amp;nbsp;init_with_context 会自己 new 一个&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-133" vertex="1">
          <mxGeometry y="26" width="660" height="44" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-135" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-133" vertex="1">
          <mxGeometry y="70" width="660" height="8" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-136" value="+ connect(): int&amp;nbsp; //&amp;nbsp;return client-&amp;gt;connect();&lt;div&gt;+&amp;nbsp;pool_list2(std::list&amp;lt;std::pair&amp;lt;int64_t, std::string&amp;gt; &amp;gt;&amp;amp; v): //&amp;nbsp;return client-&amp;gt;pool_list(v);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;border-color: var(--border-color); background-color: initial;&quot;&gt;&amp;nbsp;// 自定义 cmd，并通过&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); background-color: initial;&quot;&gt;client.mgr_command(cmd, inbl, &amp;amp;outbl, &amp;amp;outstring) 发送，最终解析信息返回&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;get_inconsistent_pgs(librados::RadosClient&amp;amp; client,&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;int64_t pool_id,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;std::vector&amp;lt;librados::PlacementGroup&amp;gt;* pgs)&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;......&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-133" vertex="1">
          <mxGeometry y="78" width="660" height="120" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-137" value="相当于对 RadosClient 的再次封装，RGWRados 持有的句柄都是 Rados" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d6b656;fillColor=#fff2cc;fontFamily=Helvetica;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="2020" y="3490" width="400" height="30" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-140" value="&lt;font style=&quot;font-size: 54px;&quot;&gt;&lt;b&gt;IO 处理层&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-1030" y="1900" width="260" height="80" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-141" value="&lt;b&gt;&lt;font style=&quot;font-size: 54px;&quot;&gt;API 层（C++ API）&lt;/font&gt;&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-1050" y="3340" width="500" height="80" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-143" value="" style="endArrow=diamondThin;endFill=0;endSize=24;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0;exitY=0.345;exitDx=0;exitDy=0;exitPerimeter=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-116" target="vteJUobceDA6RaGQ8-ky-126" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="1229" y="2330" as="sourcePoint" />
            <mxPoint x="660" y="2430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-144" value="" style="endArrow=diamondThin;endFill=0;endSize=24;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-25" target="vteJUobceDA6RaGQ8-ky-125" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="1240" y="2352" as="sourcePoint" />
            <mxPoint x="400" y="2348" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-850" y="380" />
              <mxPoint x="-840" y="2050" />
              <mxPoint x="-5" y="2050" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-145" value="" style="endArrow=diamondThin;endFill=0;endSize=24;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-25" target="vteJUobceDA6RaGQ8-ky-115" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="390" y="379" as="sourcePoint" />
            <mxPoint x="5" y="2180" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2680" y="369" />
              <mxPoint x="2690" y="2060" />
              <mxPoint x="1585" y="2060" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-146" value="Use" style="endArrow=open;endSize=12;dashed=1;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;exitX=0.561;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.473;entryY=1.032;entryDx=0;entryDy=0;entryPerimeter=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-125" target="vteJUobceDA6RaGQ8-ky-3" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="160" y="2090" as="sourcePoint" />
            <mxPoint x="320" y="2090" as="targetPoint" />
            <Array as="points">
              <mxPoint x="43" y="2060" />
              <mxPoint x="988" y="2060" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-147" value="AioCompletionImpl" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-237" y="2753" width="390" height="490" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-148" value="+ lock: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;Mutex&lt;div&gt;+&amp;nbsp;cond:&amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;Cond&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;ref:&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;// 引用计数，有 get() / put() 方法&lt;/div&gt;&lt;div&gt;+&amp;nbsp;rval:&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;// 请求的返回值&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;+&amp;nbsp;tid:&amp;nbsp;ceph_tid_t&lt;span style=&quot;border-color: var(--border-color); white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 此次请求的事务 id&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;+&amp;nbsp;objver:&amp;nbsp;version_t&lt;span style=&quot;border-color: var(--border-color); white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 请求对象操作完成后（更新后）的 user version&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;aio_write_seq:&amp;nbsp;ceph_tid_t&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;released: bool = false&amp;nbsp; // 标识本对象有无释放&lt;/div&gt;&lt;div&gt;+&amp;nbsp;complete: bool = false&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 标识此异步请求是否完成&lt;/div&gt;&lt;div&gt;+&amp;nbsp;io:&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;IoCtxImpl *&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;// 请求涉及到的&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;IoCtxImpl（如果涉及）&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;aio_write_list_item:&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;xlist&amp;lt;AioCompletionImpl*&amp;gt;::item&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+ callback_complete:&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;rados_callback_t&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;callback_complete_arg:&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;void *&lt;/span&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;callback_safe:&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;rados_callback_t&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;callback_safe_arg:&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;void *&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;// for read&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;is_read: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;bool&lt;/div&gt;&lt;div&gt;+&amp;nbsp;bl:&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;bufferlist&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;//&amp;nbsp;读操作的结果数据&lt;/div&gt;&lt;div&gt;+&amp;nbsp;blp:&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;bufferlist *&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;+&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;out_buf:&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;char *&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-147" vertex="1">
          <mxGeometry y="26" width="390" height="364" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-149" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-147" vertex="1">
          <mxGeometry y="390" width="390" height="8" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-150" value="+ wait_for_complete(): int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 阻塞式等待完成&lt;div&gt;+&amp;nbsp;is_complete(): int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 非阻塞判断是否完成&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;+&amp;nbsp;get_return_value(): int&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 返回 rval&lt;/div&gt;&lt;div&gt;+&amp;nbsp;get_version():&amp;nbsp;uint64_t&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;// 返回 objver&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-147" vertex="1">
          <mxGeometry y="398" width="390" height="92" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-151" value="PoolAsyncCompletionImpl" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="290" y="2753" width="195" height="86" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-152" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-151" vertex="1">
          <mxGeometry y="26" width="195" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-153" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-151" vertex="1">
          <mxGeometry y="52" width="195" height="8" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-154" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-151" vertex="1">
          <mxGeometry y="60" width="195" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-155" value="Use" style="endArrow=open;endSize=12;dashed=1;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;exitX=0.454;exitY=1.03;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-128" target="vteJUobceDA6RaGQ8-ky-147" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="650" y="2730" as="sourcePoint" />
            <mxPoint x="810" y="2730" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-156" value="Use" style="endArrow=open;endSize=12;dashed=1;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;exitX=0;exitY=0.46;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.555;entryY=0.003;entryDx=0;entryDy=0;entryPerimeter=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-116" target="vteJUobceDA6RaGQ8-ky-147" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="-31" y="2634" as="sourcePoint" />
            <mxPoint x="-32" y="2763" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1180" y="2390" />
              <mxPoint x="1180" y="2700" />
              <mxPoint x="-20" y="2700" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-157" value="Use" style="endArrow=open;endSize=12;dashed=1;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=-0.002;exitY=0.545;exitDx=0;exitDy=0;exitPerimeter=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-116" target="vteJUobceDA6RaGQ8-ky-151" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="540" y="2720" as="sourcePoint" />
            <mxPoint x="700" y="2720" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1200" y="2430" />
              <mxPoint x="1200" y="2710" />
              <mxPoint x="388" y="2710" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-158" value="&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;在最上层是类RadosClient，它是Librados的核心管理类，处理整个RADOS系统层&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;面以及pool层面的管理&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#82b366;fillColor=#d5e8d4;fontFamily=Helvetica;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1625" y="2100" width="450" height="40" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-159" value="类IoctxImpl实现单个pool层的对象读写等操作" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#82b366;fillColor=#d5e8d4;fontFamily=Helvetica;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-290" y="2110" width="260" height="30" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-160" value="&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;RadosClient and the related classes are the internal implementation of librados.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Above that layer sits the C API, found in include/rados/librados.h, and&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;the C++ API, found in include/rados/librados.hpp&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;*&lt;span style=&quot;background-color: initial;&quot;&gt;The C++ API sometimes implements things in terms of the C API.&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Both the C++ and C API rely on RadosClient.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;*&lt;/div&gt;&lt;div&gt;&amp;nbsp;* Visually:&lt;/div&gt;&lt;div&gt;&amp;nbsp;* +--------------------------------------+&lt;/div&gt;&lt;div&gt;&amp;nbsp;* |&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;C++ API&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;|&lt;/div&gt;&lt;div&gt;&amp;nbsp;* +--------------------+&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; |&lt;/div&gt;&lt;div&gt;&amp;nbsp;* |&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;C API&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; |&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; |&lt;/div&gt;&lt;div&gt;&amp;nbsp;* +--------------------+-----------------+&lt;/div&gt;&lt;div&gt;&amp;nbsp;* |&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; RadosClient&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; |&lt;/div&gt;&lt;div&gt;&amp;nbsp;* +--------------------------------------+&lt;/div&gt;&lt;div&gt;&amp;nbsp;*/&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#b85450;fillColor=#f8cecc;fontFamily=Helvetica;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-305" y="3340" width="650" height="200" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-161" value="AioCompletion" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="667" y="4120" width="293" height="86" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-162" value="+ pc: AioCompletionImpl *" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-161" vertex="1">
          <mxGeometry y="26" width="293" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-163" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-161" vertex="1">
          <mxGeometry y="52" width="293" height="8" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-164" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-161" vertex="1">
          <mxGeometry y="60" width="293" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-165" value="PoolAsyncCompletion" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=none;gradientColor=none;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="1090" y="4120" width="260" height="86" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-166" value="+ pc: PoolAsyncCompletionImpl *" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-165" vertex="1">
          <mxGeometry y="26" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-167" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;arcSize=42;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-165" vertex="1">
          <mxGeometry y="52" width="260" height="8" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-168" value="+ method(type): type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=default;" parent="vteJUobceDA6RaGQ8-ky-165" vertex="1">
          <mxGeometry y="60" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-169" value="" style="endArrow=diamondThin;endFill=0;endSize=24;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=0.465;exitY=0.984;exitDx=0;exitDy=0;exitPerimeter=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-105" target="vteJUobceDA6RaGQ8-ky-93" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="-987" y="3750" as="sourcePoint" />
            <mxPoint x="-827" y="3750" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-960" y="3626" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-170" value="" style="endArrow=diamondThin;endFill=0;endSize=24;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1.003;exitY=0.678;exitDx=0;exitDy=0;exitPerimeter=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-126" target="vteJUobceDA6RaGQ8-ky-121" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="510" y="3940" as="sourcePoint" />
            <mxPoint x="670" y="3940" as="targetPoint" />
            <Array as="points">
              <mxPoint x="510" y="2389" />
              <mxPoint x="520" y="3622" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-171" value="" style="endArrow=diamondThin;endFill=1;endSize=24;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-1" target="vteJUobceDA6RaGQ8-ky-104" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="-50" y="1860" as="sourcePoint" />
            <mxPoint x="110" y="1860" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-951" y="1650" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-172" value="" style="endArrow=diamondThin;endFill=0;endSize=24;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-148" target="vteJUobceDA6RaGQ8-ky-162" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="490" y="4010" as="sourcePoint" />
            <mxPoint x="650" y="4010" as="targetPoint" />
            <Array as="points">
              <mxPoint x="360" y="2960" />
              <mxPoint x="370" y="4159" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-173" value="" style="endArrow=diamondThin;endFill=0;endSize=24;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-116" target="vteJUobceDA6RaGQ8-ky-134" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="1680" y="3450" as="sourcePoint" />
            <mxPoint x="1840" y="3450" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2600" y="2408" />
              <mxPoint x="2610" y="3631" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="vteJUobceDA6RaGQ8-ky-175" value="" style="endArrow=diamondThin;endFill=0;endSize=24;html=1;rounded=0;fontFamily=Helvetica;fontSize=12;fontColor=default;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.502;exitY=0.957;exitDx=0;exitDy=0;exitPerimeter=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="vteJUobceDA6RaGQ8-ky-154" target="vteJUobceDA6RaGQ8-ky-165" edge="1">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="1040" y="3940" as="sourcePoint" />
            <mxPoint x="1200" y="3940" as="targetPoint" />
            <Array as="points">
              <mxPoint x="400" y="4080" />
              <mxPoint x="1220" y="4080" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
